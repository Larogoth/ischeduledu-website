
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>iSchedulEDU</title>
    <script type="text/javascript">
      // Single Page Apps for GitHub Pages
      // MIT License
      // https://github.com/rafgraph/spa-github-pages
      // Modified to handle Universal Links with query parameters correctly
      
      (function() {
        var location = window.location;
        var pathName = location.pathname;
        var search = location.search;
        var hash = location.hash;
        
        console.log('404.html redirect script - Original URL:', location.href);
        console.log('404.html redirect script - Pathname:', pathName);
        console.log('404.html redirect script - Search:', search);
        
        // Handle the specific case where Universal Link ?data= becomes part of pathname
        // iOS Universal Links like /import?data=... can become /?data=.../import or /import/data=...
        if (pathName.includes('?data=') && pathName.includes('/import')) {
          console.log('404.html redirect script - Detected Universal Link with ?data= in pathname');
          
          // Extract the data parameter from the pathname
          var dataMatch = pathName.match(/\?data=([^\/]+)/);
          if (dataMatch) {
            var dataParam = dataMatch[1];
            console.log('404.html redirect script - Extracted data param:', dataParam);
            
            // Reconstruct the correct URL - use replace to avoid history issues
            var correctUrl = location.protocol + '//' + location.hostname + 
                            (location.port ? ':' + location.port : '') + 
                            '/import?data=' + dataParam;
            
            console.log('404.html redirect script - Redirecting to:', correctUrl);
            window.location.replace(correctUrl);
            return;
          }
        }
        
        // Handle the alternative case where query parameters got mixed into the pathname
        // This handles cases where the URL structure gets mangled differently
        if (pathName.includes('data=') && pathName.includes('/import')) {
          console.log('404.html redirect script - Detected malformed Universal Link');
          
          // Extract the data parameter from the pathname
          var dataMatch = pathName.match(/data=([^\/]+)/);
          if (dataMatch) {
            var dataParam = dataMatch[1];
            console.log('404.html redirect script - Extracted data param:', dataParam);
            
            // Reconstruct the correct URL - use replace to avoid history issues
            var correctUrl = location.protocol + '//' + location.hostname + 
                            (location.port ? ':' + location.port : '') + 
                            '/import?data=' + dataParam;
            
            console.log('404.html redirect script - Redirecting to:', correctUrl);
            window.location.replace(correctUrl);
            return;
          }
        }
        
        // Handle normal GitHub Pages SPA routing
        var segmentCount = 0;
        var redirectUrl = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '');

        if (pathName.slice(-1) === '/') {
          pathName = pathName.slice(0, -1);
        }

        var cleanPath = pathName.split('/?/').join('/');
        cleanPath = cleanPath.split(/[?#]/)[0];

        redirectUrl += cleanPath.split('/').slice(0, 1 + segmentCount).join('/');
        redirectUrl += '/?/' + cleanPath.slice(1).split('/').slice(segmentCount).join('/');

        if (search && search.indexOf('?/') !== 0) {
          redirectUrl = redirectUrl.replace('/?/', '/?/' + search.slice(1) + '/');
        }
        if (hash) {
          redirectUrl += hash;
        }

        console.log('404.html redirect script - Final redirect URL:', redirectUrl);
        window.location.replace(redirectUrl);
      })();
    </script>
  </head>
  <body>
    <p>Redirecting...</p>
  </body>
</html>
