<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>iSchedulEDU</title>
    <script type="text/javascript">
      // Single Page Apps for GitHub Pages
      // MIT License
      // https://github.com/rafgraph/spa-github-pages
      // Modified to handle Universal Links with query parameters correctly
      
      (function() {
        var location = window.location;
        var pathName = location.pathname;
        var search = location.search;
        var hash = location.hash;
        
        console.log('404.html redirect script - Starting redirect process');
        console.log('404.html redirect script - Original URL:', location.href);
        console.log('404.html redirect script - Pathname:', pathName);
        console.log('404.html redirect script - Search:', search);
        console.log('404.html redirect script - Hash:', hash);
        
        // Handle Universal Links for import routes with query parameters
        if (pathName === '/import' && search && search.includes('data=')) {
          console.log('404.html redirect script - MATCHED Universal Link for /import with data parameter');
          console.log('404.html redirect script - Preserving URL as-is for Universal Link');
          
          // For Universal Links, we don't need to modify the URL structure
          // Just redirect to the root with the proper SPA routing format
          var correctUrl = location.protocol + '//' + location.hostname + 
                          (location.port ? ':' + location.port : '') + 
                          '/?/import' + search;
          
          console.log('404.html redirect script - Constructed correct URL:', correctUrl);
          console.log('404.html redirect script - About to redirect...');
          
          window.location.replace(correctUrl);
          return;
        }
        
        // Handle the malformed Universal Link case where the URL structure gets corrupted
        if (pathName.startsWith('/data=') && pathName.endsWith('/import')) {
          console.log('404.html redirect script - MATCHED malformed Universal Link pattern /data=.../import');
          console.log('404.html redirect script - Full pathname:', pathName);
          
          // Extract the data parameter from the pathname
          var dataParam = pathName.substring(6); // Remove '/data=' prefix
          console.log('404.html redirect script - After removing /data= prefix:', dataParam);
          
          dataParam = dataParam.substring(0, dataParam.length - 7); // Remove '/import' suffix
          console.log('404.html redirect script - After removing /import suffix:', dataParam);
          
          // Reconstruct the correct URL
          var correctUrl = location.protocol + '//' + location.hostname + 
                          (location.port ? ':' + location.port : '') + 
                          '/?/import?data=' + dataParam;
          
          console.log('404.html redirect script - Constructed correct URL:', correctUrl);
          console.log('404.html redirect script - About to redirect...');
          
          window.location.replace(correctUrl);
          return;
        }
        
        // Handle any other import routes
        if (pathName.startsWith('/import')) {
          console.log('404.html redirect script - MATCHED import route');
          var correctUrl = location.protocol + '//' + location.hostname + 
                          (location.port ? ':' + location.port : '') + 
                          '/?/' + pathName.substring(1);
          
          if (search) {
            correctUrl += search;
          }
          
          console.log('404.html redirect script - Import route redirect URL:', correctUrl);
          window.location.replace(correctUrl);
          return;
        }
        
        console.log('404.html redirect script - No Universal Link pattern matched, proceeding with normal GitHub Pages SPA routing');
        
        // Handle normal GitHub Pages SPA routing
        var segmentCount = 0;
        var redirectUrl = location.protocol + '//' + location.hostname + (location.port ? ':' + location.port : '');

        if (pathName.slice(-1) === '/') {
          pathName = pathName.slice(0, -1);
        }

        var cleanPath = pathName.split('/?/').join('/');
        cleanPath = cleanPath.split(/[?#]/)[0];

        redirectUrl += cleanPath.split('/').slice(0, 1 + segmentCount).join('/');
        redirectUrl += '/?/' + cleanPath.slice(1).split('/').slice(segmentCount).join('/');

        if (search && search.indexOf('?/') !== 0) {
          redirectUrl = redirectUrl.replace('/?/', '/?/' + search.slice(1) + '/');
        }
        if (hash) {
          redirectUrl += hash;
        }

        console.log('404.html redirect script - Normal redirect URL:', redirectUrl);
        window.location.replace(redirectUrl);
      })();
    </script>
  </head>
  <body>
    <p>Redirecting...</p>
  </body>
</html>
